"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}function _extends(){return(_extends=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t}).apply(this,arguments)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,i,e){return i&&_defineProperties(t.prototype,i),e&&_defineProperties(t,e),t}var WebsyNavigator=function(){function s(t){_classCallCheck(this,s);var i={triggerClass:"trigger-item",triggerToggleClass:"trigger-toggle",viewClass:"view",activeClass:"active",viewAttribute:"data-view",groupAttribute:"data-group",parentAttribute:"data-parent",defaultView:"",defaultGroup:"main",subscribers:{show:[],hide:[]}};if(this.triggerIdList=[],this.viewIdList=[],this.previousPath="",this.previousView="",this.currentView="",this.currentParams={},this.controlPressed=!1,window.addEventListener("popstate",this.onPopState.bind(this)),window.addEventListener("keydown",this.handleKeyDown.bind(this)),window.addEventListener("keyup",this.handleKeyUp.bind(this)),window.addEventListener("focus",this.handleFocus.bind(this)),window.addEventListener("click",this.handleClick.bind(this)),this.options=_extends({},i,t),this.options.viewClass!==i.viewClass||this.options.activeClass!==i.activeClass){var e="\n        <style>\n          .".concat(this.options.viewClass,"{ display: none; }\n          .").concat(this.options.viewClass,".").concat(this.options.activeClass,"{ display: initial; }\n\t\t\t\t\t.").concat(triggerClass,"{cursor: pointer;}\n        </style>\n      ");document.querySelector("head").innerHTML+=e}}return _createClass(s,[{key:"addGroup",value:function(t){this.groups[t]||(this.groups[t]={activeView:""})}},{key:"formatParams",value:function(t){var i={path:t,items:{}};if(void 0!==t){for(var e=t.split("&"),s=0;s<e.length;s++){var a=e[s].split("=");i.items[a[0]]=a[1]}return this.currentParams=i}}},{key:"generateId",value:function(t){for(var i="abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNOPQRSTUWXYZ0123456789",e=[],s=0;s<6;s++){var a=Math.floor(62*Math.random());e.push(i[a])}return"".concat(t,"_").concat(e.join(""))}},{key:"getActiveViewsFromParent",value:function(t){var i=[];for(var e in this.groups)this.groups[e].parent===t&&this.groups[e].activeView&&i.push(this.groups[e].activeView);return i}},{key:"handleClick",value:function(t){if(t.target.classList.contains(this.options.triggerClass)){var i=t.target.getAttribute(this.options.viewAttribute),e=t.target.getAttribute(this.options.groupAttribute);this.navigate(i,e||"main",t)}}},{key:"init",value:function(){this.registerElements(document);var t="",i=this.formatParams(this.queryParams);""===this.currentPath&&""!==this.options.defaultView?t=this.options.defaultView:""!==this.currentPath&&(t=this.currentPath),void 0!==i&&"?".concat(i.path),this.currentView=t,"/"!==this.currentView&&""!==this.currentView||(this.currentView=this.options.defaultView),""!==t&&this.showView(t,i)}},{key:"handleFocus",value:function(t){this.controlPressed=!1}},{key:"handleKeyDown",value:function(t){switch(t.key){case"Control":case"Meta":this.controlPressed=!0}}},{key:"handleKeyUp",value:function(t){this.controlPressed=!1}},{key:"hideView",value:function(t,i){if(this.hideTriggerItems(t,i),this.hideViewItems(t,i),i===this.options.defaultGroup){var e=document.getElementsByClassName("parent-".concat(t));if(e)for(var s=0;s<e.length;s++)if(e[s].classList.contains(this.options.viewClass)){var a=e[s].attributes[this.options.viewAttribute],r=e[s].attributes[this.options.groupAttribute];a&&""!==a.value&&this.hideView(a.value,r.value||this.options.defaultGroup)}}else this.groups[i]&&this.groups[i].activeView===t&&(this.groups[i].activeView=null);this.publish("hide",[t])}},{key:"registerElements",value:function(t){"#document"===t.nodeName&&(this.groups={});for(var i=t.getElementsByClassName(this.options.triggerClass),e=0;e<i.length;e++)if(i[e].id||(i[e].id=this.generateId("trigger")),-1===this.triggerIdList.indexOf(i[e].id)){this.triggerIdList.push(i[e].id);var s=i[e].attributes[this.options.viewAttribute];if(s&&""!==s.value){var a=i[e].attributes[this.options.groupAttribute],r=this.options.defaultGroup;a&&""!==a.value&&(r=a.value);var o=i[e].attributes[this.options.parentAttribute];o&&""!==o.value&&i[e].classList.add("parent-".concat(o.value)),i[e].classList.add("".concat(this.options.triggerClass,"-").concat(r))}}for(var n=t.getElementsByClassName(this.options.viewClass),u=0;u<n.length;u++){var h=n[u].attributes[this.options.groupAttribute],l=n[u].attributes[this.options.viewAttribute];h&&""!==h.value?(this.addGroup(h.value),n[u].classList.contains(this.options.activeClass)&&(this.groups[h.value].activeView=l.value),n[u].classList.add("".concat(this.options.viewClass,"-").concat(h.value))):n[u].classList.add("".concat(this.options.viewClass,"-").concat(this.options.defaultGroup));var c=n[u].attributes[this.options.parentAttribute];c&&""!==c.value&&(n[u].classList.add("parent-".concat(c.value)),h&&""!==h.value&&this.groups[h.value]&&(this.groups[h.value].parent=c.value))}}},{key:"showView",value:function(t,i){this.activateItem(t,this.options.triggerClass),this.activateItem(t,this.options.viewClass);for(var e=this.getActiveViewsFromParent(t),s=0;s<e.length;s++)this.activateItem(e[s],this.options.triggerClass),this.activateItem(e[s],this.options.viewClass),this.publish("show",[e[s]]);this.publish("show",[t,i])}},{key:"navigate",value:function(t,i,e,s){void 0===s&&(s=!1);var a,r=!1,o=t;t===this.options.defaultView&&(t=t.replace(this.options.defaultView,"/"));var n=this.currentParams.path;if(!0!==this.controlPressed||i!==this.options.defaultGroup){if(-1!==o.indexOf("?")&&i===this.options.defaultGroup){var u=o.split("?");this.formatParams(u[1]),o=u[0]}else i===this.options.defaultGroup&&(this.currentParams={});e&&(e.target&&e.target.classList.contains(this.options.triggerToggleClass)?r=!0:"boolean"==typeof e&&(r=e)),!0===r&&""!==this.groups[i].activeView&&(o=""),this.previousView=this.currentView,this.previousPath=this.currentPath,this.groups[i]&&(!1===r&&(a=this.groups[i].activeView),this.previousPath=this.groups[i].activeView),!0===r&&""!==this.previousPath?this.hideView(this.previousPath,i):this.hideView(this.previousView,i),!0===r&&o===a||(i&&this.groups[i]&&i!==this.options.defaultGroup&&(this.groups[i].activeView=o),!1===r&&(this.currentView=o),"/"===this.currentView&&(this.currentView=this.options.defaultView),!1===r?this.showView(this.currentView,this.currentParams):this.showView(o),this.currentPath===o&&n===this.currentParams.path||i!==this.options.defaultGroup||(console.log("popped",s),!1===s?(console.log("pushing state",t),history.pushState({inputPath:t},t,t)):console.log("NOT pushing state",t)))}else window.open("".concat(window.location.origin,"/").concat(t),"_blank")}},{key:"onPopState",value:function(t){t.state?this.navigate(t.state.url||t.state.inputPath,"main",null,!0):this.navigate(this.options.defaultView||"/","main",null,!0)}},{key:"publish",value:function(t,i){this.options.subscribers[t].forEach(function(t){t.apply(null,i)})}},{key:"subscribe",value:function(t,i){this.options.subscribers[t].push(i)}},{key:"hideTriggerItems",value:function(t,i){this.hideItems(this.options.triggerClass,i)}},{key:"hideViewItems",value:function(t,i){this.hideItems(t,i)}},{key:"hideItems",value:function(t,i){var e;if(e=_toConsumableArray(i&&"main"!==i?document.querySelectorAll("[".concat(this.options.groupAttribute,'="').concat(i,'"]')):document.querySelectorAll("[".concat(this.options.viewAttribute,'="').concat(t,'"]'))))for(var s=0;s<e.length;s++)e[s].classList.remove(this.options.activeClass)}},{key:"activateItem",value:function(t,i){var e=document.getElementsByClassName(i);if(e)for(var s=0;s<e.length;s++)if(e[s].attributes[this.options.viewAttribute]&&e[s].attributes[this.options.viewAttribute].value===t){e[s].classList.add(this.options.activeClass);break}}},{key:"currentPath",get:function(){var t=window.location.pathname.split("/").pop();return-1!==t.indexOf(".htm")?"":t}},{key:"queryParams",get:function(){if(1<window.location.search.length)return window.location.search.substring(1)}}]),s}();